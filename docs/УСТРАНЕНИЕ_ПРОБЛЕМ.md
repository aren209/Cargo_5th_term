# Устранение проблем при сборке и запуске

Данный документ объединяет решения типичных проблем с DLL и запуском системы (архитектура x86/x64, WinError 193, зависимости).

---

## 1. Несовпадение архитектур (x86 vs x64)

### Симптомы

- `RuntimeError: Architecture mismatch: DLL is 32-bit (x86) but Python is 64-bit.`
- `OSError: [WinError 193] %1 is not a valid Win32 application`

### Причина

DLL собрана для одной разрядности (например, 32-bit), а Python — для другой (64-bit).

### Решение

1. **Проверьте разрядность Python:**
   ```cmd
   python -c "import platform; print(platform.architecture())"
   ```
   Для 64-bit должно быть `('64bit', 'WindowsPE')`.

2. **Проверьте разрядность DLL:**
   ```cmd
   cd python_bindings
   python check_dll.py
   ```
   Скрипт покажет архитектуру DLL и совместимость с Python.

3. **Соберите DLL для x64 (рекомендуется для 64-bit Python):**
   - Откройте **x64 Native Tools Command Prompt for VS 2022** (или 2019) из меню Пуск.
   - Перейдите в каталог проекта:
     ```cmd
     cd <путь_к_проекту>\Cargo_5th_term
     ```
   - Запустите сборку:
     ```cmd
     build_dll.bat
     ```
   - Убедитесь, что в выводе указано создание DLL в `x64\Debug\FlightScheduleAPI.dll`.

4. **Через Visual Studio:** в верхней панели выберите платформу **x64** (не Win32), затем Build → Build Solution.

---

## 2. Ошибка WinError 193 («not a valid Win32 application»)

Обычно означает одно из следующего:

- Несовпадение архитектур (см. раздел 1).
- Отсутствуют зависимости (Visual C++ Runtime).
- DLL повреждена или сборка не завершилась.

### Действия

1. Запустите диагностику:
   ```cmd
   cd python_bindings
   python check_dll.py
   ```
2. Если архитектуры не совпадают — пересоберите DLL для x64 (раздел 1).
3. Установите **Visual C++ Redistributable** для вашей версии Visual Studio:
   - [VC++ Redistributable для VS 2022 (x64)](https://aka.ms/vs/17/release/vc_redist.x64.exe)
   - [VC++ Redistributable для VS 2019 (x64)](https://aka.ms/vs/16/release/vc_redist.x64.exe)
4. Если DLL очень маленькая (< 10 KB) — сборка могла не завершиться: выполните Clean и полную пересборку.

---

## 3. DLL не найдена

### Симптом

`FileNotFoundError: Could not find FlightScheduleAPI.dll`

### Решение

- Соберите проект (build_dll.bat из x64 Native Tools Command Prompt).
- DLL ищется в: `x64\Debug\`, `x64\Release\`, в каталоге `python_bindings\`, в текущей директории.
- При необходимости скопируйте DLL в `python_bindings\`:
  ```cmd
  copy x64\Debug\FlightScheduleAPI.dll python_bindings\
  ```

---

## 4. Ошибки компиляции C++

### «cl is not recognized»

Окружение Visual Studio не инициализировано. Используйте **x64 Native Tools Command Prompt** вместо обычной командной строки.

### «Cannot open include file»

Убедитесь, что запуск идёт из корня проекта (каталог `Cargo_5th_term`) и все файлы `.h` и `.cpp` присутствуют в `include/` и `src/`.

### «LINK : fatal error LNK1120»

Проверьте, что в сборку включены все нужные `.cpp` файлы (в build_dll.bat или в проекте VS).

### DLL по-прежнему 32-bit после сборки

1. Удалите старую DLL.
2. Убедитесь, что используете именно **x64 Native Tools Command Prompt**.
3. Выполните пересборку.

---

## 5. Кириллица отображается неправильно

В консоли установите кодировку UTF-8:
```cmd
chcp 65001
```
В GUI кириллица обычно работает при стандартной установке Python и tkinter.

---

## 6. Проверка успешной настройки

После сборки и настройки:

```cmd
cd python_bindings
python check_dll.py
```

Ожидаемый вывод (для 64-bit):

```
Архитектура DLL: x64
Архитектура Python: 64bit
  ✓ Архитектуры совместимы
  ✓ DLL успешно загружена!
```

Затем запуск GUI:

```cmd
python flight_schedule_gui.py
```

---

Дополнительно: [дополнительно/QUICK_START.md](дополнительно/QUICK_START.md), [дополнительно/PYTHON_GUI_README.md](дополнительно/PYTHON_GUI_README.md).
